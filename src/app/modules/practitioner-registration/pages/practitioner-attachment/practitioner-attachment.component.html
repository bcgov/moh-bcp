<h1>{{pageTitle}}</h1>
<p>To add a new attachment, cancel an existing attachment, or change an existing attachment you must provide the appropriate effective or cancellation date.</p>
<hr/>

<form [formGroup]="formGroup">

  <div class="form-group">
    <common-radio formControlName="attachmentType"
                  name="attachmentType"
                  label="What change are you making for Business Cost Premium to the facility?"
                  [radioLabels]='radioItems'
                  display="table-row-group"
                  (ngModelChange)='changeAttachmentType($event)'>
    </common-radio>
  </div>

  <ng-container *ngIf='shouldShowNewSection'>
    <h2>Add new attachment</h2>
    <ul>
      <li>Effective Date - is the date the practitioner began practice at the facility as an Eligible Physician</li>
      <li>Cancellation Date (if applicable) - the date at which the locum is completed</li>
    </ul>
    <hr/>
    <div class="form-group">
      <common-radio formControlName="newAttachmentType"
                    name="newAttachmentType"
                    label="Is this attachment a Locum or temporary?"
                    display="table-row-group"
                    (ngModelChange)='changeNewAttachmentType($event)'>
      </common-radio>
    </div>

    <div class="form-group" *ngIf='dataService.pracNewAttachmentType === true || dataService.pracNewAttachmentType === false'>
      <common-date label='Effective date for new attachment'
                   name="attachmentEffectiveDate"
                   formControlName="attachmentEffectiveDate"
                   [dateRangeStart]='effectiveDateStartRange'
                   [dateRangeEnd]='effectiveDateEndRange'
                   [errorMessage]='facilityEffectiveDateErrMsg'>
      </common-date>
    </div>

    <div class="form-group" *ngIf='dataService.pracNewAttachmentType === true'>
      <common-date label='Cancellation date for new attachment'
                   name="attachmentCancelDate"
                   formControlName="attachmentCancelDate"
                   [dateRangeStart]='cancelDateStartRange'
                   [dateRangeEnd]='cancelDateEndRange'
                   [errorMessage]='facilityCancelDateErrMsg'>
      </common-date>
    </div>
  </ng-container>

  <ng-container *ngIf='shouldShowCancelSection'>
    <div class="form-group">
      <common-date label='Cancellation date for existing attachment'
                    name="attachmentCancelDate"
                    formControlName="attachmentCancelDate"
                    [dateRangeStart]='cancelDateStartRange'
                    [dateRangeEnd]='cancelDateEndRange'
                    [errorMessage]='facilityCancelDateErrMsg'>
      </common-date>
    </div>
  </ng-container>

  <ng-container *ngIf='shouldShowChangeSection'>
    <div class="form-group">
      <common-date label='New effective date for existing attachment (if applicable)'
                    name="attachmentEffectiveDate"
                    formControlName="attachmentEffectiveDate"
                    [dateRangeStart]='effectiveDateStartRange'
                    [dateRangeEnd]='effectiveDateEndRange'
                    [errorMessage]='facilityEffectiveDateErrMsg'>
      </common-date>
    </div>

    <div class="form-group">
      <common-date label='New cancellation date for existing attachment (if applicable)'
                    name="attachmentCancelDate"
                    formControlName="attachmentCancelDate"
                    [dateRangeStart]='cancelDateStartRange'
                    [dateRangeEnd]='cancelDateEndRange'
                    [errorMessage]='facilityCancelDateErrMsg'>
      </common-date>
      {{facilityCancelDateErrMsg.invalidRange}} - {{cancelDateStartRange}} - {{cancelDateEndRange}}
    </div>

    <common-error-container [displayError]="(formGroup?.controls?.changeAttachmentHasAtLeastOneDate?.dirty || formGroup?.controls?.changeAttachmentHasAtLeastOneDate?.touched) &&  formGroup?.controls?.changeAttachmentHasAtLeastOneDate?.errors">
      <div *ngIf="!formGroup?.controls?.changeAttachmentHasAtLeastOneDate?.errors?.requiredTrue">
        At least one of the date fields is required
      </div>
    </common-error-container>
  </ng-container>

</form>
